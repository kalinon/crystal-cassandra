<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.26.1">


<link href="css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "";
</script>

  <meta id="repository-name" content="github.com/kaukas/crystal-cassandra">
  <title>README - github.com/kaukas/crystal-cassandra</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="repository-links">
      <a href="index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra" data-name="cassandra">
      <a href="Cassandra.html">Cassandra</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi" data-name="cassandra::dbapi">
      <a href="Cassandra/DBApi.html">DBApi</a>
      
        <ul>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Any" data-name="cassandra::dbapi::any">
      <a href="Cassandra/DBApi/Any.html">Any</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Cluster" data-name="cassandra::dbapi::cluster">
      <a href="Cassandra/DBApi/Cluster.html">Cluster</a>
      
    </li>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/CommonUuid" data-name="cassandra::dbapi::commonuuid">
      <a href="Cassandra/DBApi/CommonUuid.html">CommonUuid</a>
      
        <ul>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/CommonUuid/UuidError" data-name="cassandra::dbapi::commonuuid::uuiderror">
      <a href="Cassandra/DBApi/CommonUuid/UuidError.html">UuidError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Connection" data-name="cassandra::dbapi::connection">
      <a href="Cassandra/DBApi/Connection.html">Connection</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Date" data-name="cassandra::dbapi::date">
      <a href="Cassandra/DBApi/Date.html">Date</a>
      
    </li>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders" data-name="cassandra::dbapi::decoders">
      <a href="Cassandra/DBApi/Decoders.html">Decoders</a>
      
        <ul>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/BaseDecoder" data-name="cassandra::dbapi::decoders::basedecoder">
      <a href="Cassandra/DBApi/Decoders/BaseDecoder.html">BaseDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/BigintDecoder" data-name="cassandra::dbapi::decoders::bigintdecoder">
      <a href="Cassandra/DBApi/Decoders/BigintDecoder.html">BigintDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/BooleanDecoder" data-name="cassandra::dbapi::decoders::booleandecoder">
      <a href="Cassandra/DBApi/Decoders/BooleanDecoder.html">BooleanDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/DateDecoder" data-name="cassandra::dbapi::decoders::datedecoder">
      <a href="Cassandra/DBApi/Decoders/DateDecoder.html">DateDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/DoubleDecoder" data-name="cassandra::dbapi::decoders::doubledecoder">
      <a href="Cassandra/DBApi/Decoders/DoubleDecoder.html">DoubleDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/DurationDecoder" data-name="cassandra::dbapi::decoders::durationdecoder">
      <a href="Cassandra/DBApi/Decoders/DurationDecoder.html">DurationDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/FloatDecoder" data-name="cassandra::dbapi::decoders::floatdecoder">
      <a href="Cassandra/DBApi/Decoders/FloatDecoder.html">FloatDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/IntDecoder" data-name="cassandra::dbapi::decoders::intdecoder">
      <a href="Cassandra/DBApi/Decoders/IntDecoder.html">IntDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/ListDecoder" data-name="cassandra::dbapi::decoders::listdecoder">
      <a href="Cassandra/DBApi/Decoders/ListDecoder.html">ListDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/MapDecoder" data-name="cassandra::dbapi::decoders::mapdecoder">
      <a href="Cassandra/DBApi/Decoders/MapDecoder.html">MapDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/SetDecoder" data-name="cassandra::dbapi::decoders::setdecoder">
      <a href="Cassandra/DBApi/Decoders/SetDecoder.html">SetDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/SmallIntDecoder" data-name="cassandra::dbapi::decoders::smallintdecoder">
      <a href="Cassandra/DBApi/Decoders/SmallIntDecoder.html">SmallIntDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/StringDecoder" data-name="cassandra::dbapi::decoders::stringdecoder">
      <a href="Cassandra/DBApi/Decoders/StringDecoder.html">StringDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/TimeDecoder" data-name="cassandra::dbapi::decoders::timedecoder">
      <a href="Cassandra/DBApi/Decoders/TimeDecoder.html">TimeDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/TimestampDecoder" data-name="cassandra::dbapi::decoders::timestampdecoder">
      <a href="Cassandra/DBApi/Decoders/TimestampDecoder.html">TimestampDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/TimeUuidDecoder" data-name="cassandra::dbapi::decoders::timeuuiddecoder">
      <a href="Cassandra/DBApi/Decoders/TimeUuidDecoder.html">TimeUuidDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/TinyIntDecoder" data-name="cassandra::dbapi::decoders::tinyintdecoder">
      <a href="Cassandra/DBApi/Decoders/TinyIntDecoder.html">TinyIntDecoder</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Decoders/UuidDecoder" data-name="cassandra::dbapi::decoders::uuiddecoder">
      <a href="Cassandra/DBApi/Decoders/UuidDecoder.html">UuidDecoder</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Driver" data-name="cassandra::dbapi::driver">
      <a href="Cassandra/DBApi/Driver.html">Driver</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Duration" data-name="cassandra::dbapi::duration">
      <a href="Cassandra/DBApi/Duration.html">Duration</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Error" data-name="cassandra::dbapi::error">
      <a href="Cassandra/DBApi/Error.html">Error</a>
      
    </li>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/PreparedStatement" data-name="cassandra::dbapi::preparedstatement">
      <a href="Cassandra/DBApi/PreparedStatement.html">PreparedStatement</a>
      
        <ul>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/PreparedStatement/StatementPrepareError" data-name="cassandra::dbapi::preparedstatement::statementprepareerror">
      <a href="Cassandra/DBApi/PreparedStatement/StatementPrepareError.html">StatementPrepareError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Primitive" data-name="cassandra::dbapi::primitive">
      <a href="Cassandra/DBApi/Primitive.html">Primitive</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/RawStatement" data-name="cassandra::dbapi::rawstatement">
      <a href="Cassandra/DBApi/RawStatement.html">RawStatement</a>
      
    </li>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/ResultSet" data-name="cassandra::dbapi::resultset">
      <a href="Cassandra/DBApi/ResultSet.html">ResultSet</a>
      
        <ul>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/ResultSet/IteratorError" data-name="cassandra::dbapi::resultset::iteratorerror">
      <a href="Cassandra/DBApi/ResultSet/IteratorError.html">IteratorError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Session" data-name="cassandra::dbapi::session">
      <a href="Cassandra/DBApi/Session.html">Session</a>
      
        <ul>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Session/ConnectError" data-name="cassandra::dbapi::session::connecterror">
      <a href="Cassandra/DBApi/Session/ConnectError.html">ConnectError</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/StatementError" data-name="cassandra::dbapi::statementerror">
      <a href="Cassandra/DBApi/StatementError.html">StatementError</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Time" data-name="cassandra::dbapi::time">
      <a href="Cassandra/DBApi/Time.html">Time</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/TimeUuid" data-name="cassandra::dbapi::timeuuid">
      <a href="Cassandra/DBApi/TimeUuid.html">TimeUuid</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Type" data-name="cassandra::dbapi::type">
      <a href="Cassandra/DBApi/Type.html">Type</a>
      
    </li>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/Uuid" data-name="cassandra::dbapi::uuid">
      <a href="Cassandra/DBApi/Uuid.html">Uuid</a>
      
    </li>
  
  <li class="parent " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/ValueBinder" data-name="cassandra::dbapi::valuebinder">
      <a href="Cassandra/DBApi/ValueBinder.html">ValueBinder</a>
      
        <ul>
  
  <li class=" " data-id="github.com/kaukas/crystal-cassandra/Cassandra/DBApi/ValueBinder/BindError" data-name="cassandra::dbapi::valuebinder::binderror">
      <a href="Cassandra/DBApi/ValueBinder/BindError.html">BindError</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1>Crystal DB API for Cassandra</h1>

<p>A Crystal wrapper around the <a href="https://docs.datastax.com/en/developer/cpp-driver/2.10/" target="_blank">DataStax C/C++
Driver</a>. It conforms to
the <a href="https://github.com/crystal-lang/crystal-db" target="_blank">crystal-db</a> API.</p>

<h2>Status</h2>

<p>This is a personal project to create something meaningful while learning
Crystal. There are no guarantees about future development, maintenance, or
support. That said, if you need to use Crystal to query Cassandra this library
could be a good starting point. YMMV.</p>

<h2>Installation</h2>

<p>Please make sure you have <a href="https://datastax.github.io/cpp-driver/topics/building/" target="_blank">installed the DataStax C/C++
Driver</a>. You can use
"development" packages if they are available or build from source.</p>

<p>Then add this to your application's <code>shard.yml</code>:</p>

<pre><code class="language-yaml">dependencies:
  cassandra:
    github: kaukas/crystal-cassandra</code></pre>

<h2>Documentation</h2>

<p>The <a href="https://kaukas.github.io/crystal-cassandra/latest/" target="_blank">latest Crystal Cassandra API documentation can be found
here</a>.</p>

<h2>Usage</h2>

<p>From the <a href="https://github.com/kaukas/crystal-cassandra/blob/master/examples/basic.cr" target="_blank">basic
example</a>:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;cassandra/dbapi&quot;</span>

<span class="t">DB</span>.open(<span class="s">&quot;cassandra://127.0.0.1/test&quot;</span>) <span class="k">do</span> <span class="o">|</span>db<span class="o">|</span>
  db.exec(<span class="s">&lt;&lt;-CQL)
    create table posts (
      id timeuuid primary key,
      title text,
      body text,
      created_at timestamp
    )
  CQL</span>
  db.exec(<span class="s">&quot;insert into posts (id, title, body, created_at) values (now(), ?, ?, ?)&quot;</span>,
          <span class="s">&quot;Hello World&quot;</span>,
          <span class="s">&quot;Hello, World. I have a story to tell.&quot;</span>,
          <span class="t">Time</span>.now)
  db.query(<span class="s">&quot;select title, body, created_at from posts&quot;</span>) <span class="k">do</span> <span class="o">|</span>rs<span class="o">|</span>
    rs.each <span class="k">do</span>
      title <span class="o">=</span> rs.read(<span class="t">String</span>)
      body <span class="o">=</span> rs.read(<span class="t">String</span>)
      created_at <span class="o">=</span> rs.read(<span class="t">Time</span>)
      puts title
      puts <span class="s">&quot;(</span><span class="i">#{</span>created_at<span class="i">}</span><span class="s">)&quot;</span>
      puts body
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Please refer to <a href="https://github.com/crystal-lang/crystal-db" target="_blank">crystal-db</a> for
further usage instructions.</p>

<h2>Types</h2>

<p><code>crystal-cassandra</code> supports <a href="https://crystal-lang.github.io/crystal-db/api/0.5.0/DB/Any.html" target="_blank">all the
<code>DB::Any</code></a>
primitive types plus <code>Int8</code> and <code>Int16</code> and some additional value types:</p>

<ul><li><code>date</code> maps to <code><a href="Cassandra/DBApi/Date.html">Cassandra::DBApi::Date</a></code></li><li><code>time</code> maps to <code><a href="Cassandra/DBApi/Time.html">Cassandra::DBApi::Time</a></code></li><li><code>duration</code> maps to <code><a href="Cassandra/DBApi/Duration.html">Cassandra::DBApi::Duration</a></code></li><li><code>uuid</code> maps to <code><a href="Cassandra/DBApi/Uuid.html">Cassandra::DBApi::Uuid</a></code></li><li><code>timeuuid</code> maps to <code><a href="Cassandra/DBApi/TimeUuid.html">Cassandra::DBApi::TimeUuid</a></code></li></ul>

<p>Some of the collection types are also supported:</p>

<ul><li><code>list</code> maps to <code>Array</code></li><li><code>set</code> maps to <code>Set</code></li><li><code>map</code> maps to <code>Hash</code></li></ul>

<h3>Casting</h3>

<p>Cassandra supports nested collection types (lists, sets, maps, etc.). Since
Crystal <a href="https://github.com/crystal-lang/crystal/issues/5155" target="_blank">deprecated recursive
aliases</a> they can be
represented with recursive structs. <code>crystal-cassandra</code> has
<code><a href="Cassandra/DBApi/Any.html">Cassandra::DBApi::Any</a></code> which performs a similar function to
<a href="https://crystal-lang.org/api/latest/JSON/Any.html" target="_blank"><code>JSON::Any</code></a>. You can pass
collection parameters to queries wrapped with <code><a href="Cassandra/DBApi/Any.html">Cassandra::DBApi::Any</a></code> (taken
from the <a href="https://github.com/kaukas/crystal-cassandra/blob/master/examples/collections.cr" target="_blank">collections
example</a>):</p>

<pre><code class="language-crystal"><span class="k">alias</span> <span class="t">Any</span> <span class="o">=</span> <span class="t">Cassandra</span><span class="t">::</span><span class="t">DBApi</span><span class="t">::</span><span class="t">Any</span>

<span class="c"># Assuming `authors` is `list&lt;text&gt;`</span>
db.exec(<span class="s">&quot;insert into posts (id, authors) values (now(), ?)&quot;</span>,
        <span class="t">Any</span>.<span class="k">new</span>([<span class="t">Any</span>.<span class="k">new</span>(<span class="s">&quot;John Doe&quot;</span>), <span class="t">Any</span>.<span class="k">new</span>(<span class="s">&quot;Ben Roe&quot;</span>)]))

db.query(<span class="s">&quot;select authors from posts&quot;</span>) <span class="k">do</span> <span class="o">|</span>rs<span class="o">|</span>
  rs.each <span class="k">do</span>
    authors <span class="o">=</span> rs.read(<span class="t">Array</span>(<span class="t">Any</span>))
    puts <span class="s">&quot;Authors: </span><span class="i">#{</span>authors.map { <span class="o">|</span>author<span class="o">|</span> author.as_s <span class="i">}</span><span class="s">.join(&quot;</span>, <span class="s">&quot;)}&quot;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>You could do the same for the primitive values as well:</p>

<pre><code class="language-crystal">db.exec(<span class="s">&quot;insert into posts (id, title) values (now(), ?)&quot;</span>,
        <span class="t">Any</span>.<span class="k">new</span>(<span class="s">&quot;Hello World&quot;</span>))

db.query(<span class="s">&quot;select title from posts&quot;</span>) <span class="k">do</span> <span class="o">|</span>rs<span class="o">|</span>
  rs.each <span class="k">do</span>
    title <span class="o">=</span> rs.read(<span class="t">Any</span>)
    puts title.as_s
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>but shortcuts are defined for them so <code>Any</code> can be skipped (see the <a href="https://github.com/kaukas/crystal-cassandra/blob/master/examples/basic.cr" target="_blank">basic
example</a>).</p>

<h2>Development</h2>

<p>Install the C/C++ Driver. The <code>Makefile</code> commands work on MacOS:</p>

<pre><code class="language-bash">$ make build-cppdriver</code></pre>

<p>Start a Docker container with an instance of Cassandra:</p>

<pre><code class="language-bash">$ make start-cassandra</code></pre>

<p>Run the tests:</p>

<pre><code class="language-bash">$ crystal spec</code></pre>

<p>Stop Cassandra when finished:</p>

<pre><code class="language-bash">$ make stop-cassandra</code></pre>

<h2>Contributing</h2>

<ol><li>Fork it (&lt;https://github.com/kaukas/crystal-cassandra/fork>)</li><li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li><li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li><li>Push to the branch (<code>git push origin my-new-feature</code>)</li><li>Create a new Pull Request</li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/kaukas" target="_blank">kaukas</a> Linas Juškevičius - creator, maintainer</li></ul>
</div>
</body>
</html>
